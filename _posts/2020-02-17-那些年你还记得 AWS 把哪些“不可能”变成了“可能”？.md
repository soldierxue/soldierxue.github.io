---
layout:     post
title:      那些年你还记得 AWS 把哪些“不可能”变成了“可能”？
subtitle:   宅时光之 Refresh 新知系列
date:       2020-02-17
author:     薛以致用
header-img: img/post-bg20200106.jpeg
catalog: true
tags:
    - AWS
    - 学习
    - 新知
---
# 申明

_本站点所有文章，仅代表个人想法，不代表任何公司立场，所有数据都来自公开资料_

*转载请注明出处*

德鲁克研究会(Drucker Institute) 评选出 2019年度美国公司管理成效 250 强榜单上，科技巨头亚马逊荣登榜首，在总分前100名企业中，亚马逊公司在“创新”方面的得分远超其他公司，达到了 212.3分；归属亚马逊云计算业务的 AWS 推陈出新的速度也是刷刷的快，脑子里突然闪现出，这些年跑的客户现场，当时跟客户坦白说“臣妾做不到”的那些事，站在这个时间点，我们一起来刷新下关于 AWS 的新知，技术日新月异，证书过期了记得 Renew ~

# “你们能帮我的数据中心改造成为类似 AWS 的平台吗？”

AWS 的基础设施以前就区域，可用区和边缘节点，建设和运营都是 AWS 自己，AWS 一直坚持做一朵云，云技术输出到客户的数据中心，当时是一个非常大胆而没有明确答案的拷问，因为 AWS 坚信公有云的本质就是，客户使用云服务作为企业新的 IT 基础设施，按需使用，按需付费；但客户也有自己的考量，比如数据不能出数据中心，监管问题等等；

怎么破？

真没想到，AWS 2019年底的 reinvent 大会正式发布了 AWS Outposts，是一个只租不卖的机柜，可以物流送到某个客户的机房，通电联网，搞定，AWS 的服务就搬到你的数据中心了，在本地的 AWS 上跑你的工作负载，自己的机房就可以享受 AWS 已经有的各种云服务以及持续不断的创新；所有麻烦的事情， AWS 都帮客户搞定，客户如同使用 AWS 区域里的服务一样使用本地的 Outposts 里面的服务；

这是怎样的创新呢？ 如需进一步了解请参考[《re:Invent 观察——AWS 是如何做私有云的》](https://mp.weixin.qq.com/s?__biz=MzU3Mzg1Njk0Ng==&mid=2247484082&idx=1&sn=6ccdb7cf37910a0b8d745d536eb2f7d6&chksm=fd3a0f6fca4d8679665bd60e6c890c9625f57661b65a3e9e13d4136d4adf5b85ff3d6631bbaa&token=1919879012&lang=zh_CN#rd)

# “切记一个磁盘只能绑定到一台虚拟机？！”

AWS 的块存储服务是 EBS，其他友商叫云盘或磁盘，本质上云计算里面的磁盘都是网络盘，一直以来大家的认知都是，一块可读/写的磁盘同时只能挂到一个实例（虚拟机）；

但是 2月14日情人节，AWS [公布了一条更新](https://amazonaws-china.com/cn/blogs/aws/new-multi-attach-for-provisioned-iops-io1-amazon-ebs-volumes/)，支持将 EBS 磁盘挂载到同一个可用区的多个 EC2 实例上，支持多机同时读写；目前为止也是仅有的 AWS 一家云厂商支持这样的特性。

根据官方文档可知，一块 EBS 盘最大 16TB，在 Linux 操作系统下，常见机型可挂载的 EBS 磁盘数量在 28个 到 31个之间（包括根盘，网卡和本地盘），也就是说，常见机型下，多台机器可共享最大 16TB * （31 - 2） = 464 TB 大小的块存储。

# “建 VPC 的时候，地址段一定要设对不能改的？！”

一个 VPC 中的 IP 地址耗尽是一个非常麻烦的事情，新的机器起不来，甚至影响背后的弹性扩展。但客户有时很难确定一个恰当大小的 CIDR 范围，所以干脆设一个比较大的地址范围，往往比较浪费，也会引发安全担忧；

现在，你可以把一个大的地址段，按照着陆区的原则，分成多个合理大小的单位网段组，按规划功能区，初始化一个单位网段，耗尽之后，在给 VPC 添加一个单位网段，从而做到按需扩展可用的地址空间。

# “我们只想用裸金属机器，虚拟化损耗太多性能？！”

你的理解是对的，但那是在 AWS Nitro 系统出来之前，AWS 在 2016 年对外公布了 Nitro 技术，到 2018 年年底，Nitro 已经迭代到了第四个版本；Nitro Hypervisor 基于 KVM，并将网络、存储、安全管理及监控功能，解耦迁移到特别设计的 Nitro 硬件卡中。

经过第三方测试， Nitro Hypervisor 对宿主机的性能损耗在 1% 以下。

详情请参考 [《案例分享：万台虚机规模的Netflix如何玩转Amazon EC2》](https://mp.weixin.qq.com/s?__biz=MzU3Mzg1Njk0Ng==&mid=2247483963&idx=1&sn=0d1640e641cc0240bab2f3a394f799e2&chksm=fd3a0fe6ca4d86f05065262fbe09248f8346ebb68b89b2a0d18caf99a9a14f4ca1a752c53769&token=1919879012&lang=zh_CN#rd) 和[《费老师的技术闲话之一：螺蛳壳里做道场——细数云计算里的虚拟化》](https://mp.weixin.qq.com/s?__biz=Mzg5MDAyMzIyMQ==&mid=2247483749&idx=1&sn=1f25955e1fa7f9d903a1bac20a1b99c1&scene=21#wechat_redirect)

# “我们能不能利用你们的全球骨干网构建我们的全球网络？！”

很多全球业务拓展的客户，构建海外的办公网和生产网，成本很高，而且建设周期很长。

以前我们只能推荐网络合作伙伴 + AWS 才能实现这样的需求，而实施当中最大的难点就是，每个引入的第三方网络虚拟化设备的高可用及路由自动切换的问题；

现在利用 AWS Direct Connect Gateway 和 Transit Gateway 两个新的网络服务，可以方便利用 AWS 骨干网快速打通客户自己的海外办公室，合作伙伴以及在 AWS 区域的应用服务网络。

# “你们的负载均衡支持自定义请求转发规则吗？！“

以前，我们的应用负载均衡功能非常纯粹，只支持基于 Path 和 Host 的规则转发，流量分发的算法也是无法自定义；在微服务大行其道的今天，客户对于负载均衡的功能要求越来越高。

而如今，AWS ALB 支持很多高级路由功能：

* 支持加权目标组转发，这对于蓝绿或金丝雀部署，或者混合迁移的场景特别有用，比如你设定 1% 的流量给到新部署的服务，剩下的继续发送给另外一个后端目标服务。
* 除了 轮询（Round Roubin）算法之外，又增加了一个 最小未处理请求数（Least outstanding requests）算法，这对于具有不同请求大小的工作负载、具有频繁改变的容器和其他目标的目标组以及具有不同处理能力级别的目标（包括在单个 Auto Scaling 组中具有实例类型混合的目标）特别有用。
* 转发能力支持 Forward，Redirect，用户身份认证或固定返回等等，这样你可以定义哪些访问路径是需要认证之后才能查看的，[认证模块也可以独立出来，利用托管的 Amazon Cognito 或者 第三方 IdP 身份提供商服务](https://aws.amazon.com/cn/blogs/china/built-in-authentication-in-alb/)。

更多请参考官方文档。

# “你们的机器太贵了？！”

初看起来是这样的，但实际上呢？

第一个我们要达成的共识，云是一种新的基础设施，以云服务的 API 为接口，根据客户的请求数量动态来弹性伸缩，要满足同一种业务需求，有很多种架构选型；如果你还是静态的资源分配，做技术的你一定可以看出优化的地方；我们相信商务手段之外，整体技术优化带给团队的优势的长久可持续的。

第二个我们要达成的共识，哪怕是用虚机，这个印象也不尽然完整：

* 去年底网易游戏的基础设施部门分享过，利用 AWS 不断的技术创新，成本可以持续优化，比如用 A1 替换原来的 C4，成本直接节约了 49%，A1 机型替代 C5，可节约 40%；
* AWS 把多余的计算资源通过 竞价的市场低价供应给客户，最高可以节约 90% 成本；而且竞价的场景特别丰富和成熟，比如容器平台，Hadoop集群，HPC等等。
* 最新基于Nitro架构的 C5/M5/R5 以及预览阶段的 M6g/C6g/R6g 在性能提升的同时，成本也大幅降低；机器学习广泛流行的今天，主打 GPU 推理的 G4 机型在市场上非常有竞争力；

第三个我们要达成的共识，从 2006年到现在，持续降价是 AWS 一个传统。中国区最近一次降价新闻是去年上海技术峰会宣布的，“AWS降价调整近50%加速落地中国战略”。

不怕买贵了，就怕买错了，简化之后的 Savings Plan 可以跨区域跨所有计算资源打折，是时候找业务拓展经理了解下了。

更多请参考[《从AWS看云服务成本优化：多样性、规模化和技术进步是客户最大的自由》](https://mp.weixin.qq.com/s?__biz=MzU3Mzg1Njk0Ng==&mid=2247483998&idx=1&sn=a1321e713ad0d7aad8e4ba546f9df233&chksm=fd3a0f83ca4d86957f0d8fc7f4348443d526708599030481d748ae7dc333b3c3290e73f9d8ea&token=1919879012&lang=zh_CN#rd)

# 后记

我想每个人都有自己的“固执己见”，不过随着每年的技术加速迭代创新，很多“不可能”都将成为历史。

如果本文也让你回忆起某个印象深刻的“偏见”也请大家后台回复，刷新刷新这些美好和老土的旧时光，技术人不容易，不是“停课不停学”，而是“学习不能停”。


